# This sample script is written for a mild shock aversion learning assay. 

# Users need to ensure that the correct assets are used in the script and saved to the unit's Media directory.

# The metal shocking plates should be plugged in and place at the ends of the tank. 

# You can use colour or images for stimuli. There are define statements on lines 22 and 23 to alter. 
# To use the the images hash out the colour INVOKE statements (lines 93, 97, 120, 143, 173, 196, 227, 248) 
# or vice versa, to use colours hash out the sprite INVOKE statements (lines 92, 96, 119, 142, 172, 195, 226, 247).  

INCLUDE ZSYS			
      
DEFINE CIRCLE 1
DEFINE SQUARE 2
DEFINE SPRITE 5

# define experiment requirements

DEFINE UNIT_TIME 300

DEFINE PROBE_TIME 60						

# define the animal model tracking requirments (dependent on animal size)
SET(DETECTOR_THRESHOLD,5)
SET(SEARCH_DISTANCE,50)
SET(SEARCH_STEP,7)
SET(FILTER_RADIUS,15)

# define auto reference tracking requirements
SET(AUTOREF_MODE,0)		     #movement based        
SET(AUTOREF_TIMEOUT,60)
AUTOREFERENCE()

# loads tracking assets
LOAD(DETECTORS,"zones_2w.bmp")              
LOAD(ARENAS,"arenas_4l_shock.bmp") 

# loads the voltage level for the shocking plates
SET(VOLTAGE_LEVEL,9000)	
    
SET(COUNTER1,COUNTER_ZERO)
SET(COUNTER2,COUNTER_ZERO)
SET(COUNTER3,COUNTER_ZERO)
SET(COUNTER4,COUNTER_ZERO)

ACTION MAIN				   
    
	LIGHTS(ALL,OFF)                      
	AUTOREFERENCE()
    VIDEO(2650,"controlgrey")
	
    
    LOGCREATE("RUNTIME|TEXT:PHASE|TEXT:TIME_BIN")
    LOGAPPEND("TEXT:ARENA1_ZONE1_DISTANCE|TEXT:ARENA1_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA2_ZONE1_DISTANCE|TEXT:ARENA2_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA3_ZONE1_DISTANCE|TEXT:ARENA3_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA4_ZONE1_DISTANCE|TEXT:ARENA4_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA1_ZONE1_TIME|TEXT:ARENA1_ZONE2_TIME")
    LOGAPPEND("TEXT:ARENA2_ZONE1_TIME|TEXT:ARENA2_ZONE2_TIME") 
    LOGAPPEND("TEXT:ARENA3_ZONE1_TIME|TEXT:ARENA3_ZONE2_TIME")
    LOGAPPEND("TEXT:ARENA4_ZONE1_TIME|TEXT:ARENA4_ZONE2_TIME") 
    LOGAPPEND("TEXT:ARENA1_ZONE1_ENTRIES|TEXT:ARENA1_ZONE2_ENTRIES")
    LOGAPPEND("TEXT:ARENA2_ZONE1_ENTRIES|TEXT:ARENA2_ZONE2_ENTRIES") 
    LOGAPPEND("TEXT:ARENA3_ZONE1_ENTRIES|TEXT:ARENA3_ZONE2_ENTRIES")
	LOGAPPEND("TEXT:ARENA4_ZONE1_ENTRIES|TEXT:ARENA4_ZONE2_ENTRIES")
    LOGAPPEND("TEXT:ARENA1_TOTAL_DISTANCE|TEXT:ARENA2_TOTAL_DISTANCE")
    LOGAPPEND("TEXT:ARENA3_TOTAL_DISTANCE|TEXT:ARENA4_TOTAL_DISTANCE")
    LOGRUN()
    
    LOGDATA(DATA_SNAPSHOT,"begin") 
    INVOKE(HABITUATION_SEQ,1)  
	INVOKE(BASELINE_SEQ,3)                      
	INVOKE(SHOCK_SEQ,12)              
	INVOKE(PROBE_SEQ,1)                     
	
    LOGDATA(DATA_SNAPSHOT,"after") 	
	LOGDATA(DATA_SELECT,"begin")         
	LOGDATA(DATA_DELTA,"after") 
    
    LOGCREATE("RUNTIME|TEXT:TOTAL|TEXT:") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()
    
COMPLETE				    


ACTION HABITUATION_SEQ 
    
    INVOKE(HABITUATION,1)
    INVOKE(HABITUATION_SWITCH,1)
    LIGHTS(ALL,OFF)					

COMPLETE                                  

ACTION HABITUATION
    
    SET(COUNTER1,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGINHAB1")  
    
    INVOKE(LT1GREYLT2CHECK,1)
	
	LOGDATA(DATA_SNAPSHOT,"BEGINHAB")
	WAIT(UNIT_TIME)
    
	LOGDATA(DATA_SNAPSHOT,"AFTERHAB1")
	LOGDATA(DATA_SELECT,"BEGINHAB1")            
	LOGDATA(DATA_DELTA,"AFTERHAB1")
	
	LOGCREATE("RUNTIME|TEXT:HABITUATION|COUNTER1") 
    LOGAPPEND("ZONE_DISTANCES:A1-2 Z1-4|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()                     

COMPLETE


ACTION HABITUATION_SWITCH
	
    SET(COUNTER1,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGINHAB2")
    
    INVOKE(LT1CHECKLT2GREY,1)
 
	WAIT(UNIT_TIME)
	LOGDATA(DATA_SNAPSHOT,"AFTERHAB2")  
	LOGDATA(DATA_SELECT,"BEGINHAB2")     
	LOGDATA(DATA_DELTA,"AFTERHAB2")
	
	LOGCREATE("RUNTIME|TEXT:HABITUATION|COUNTER1") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()
	
COMPLETE         	


ACTION BASELINE_SEQ 
    
    INVOKE(BASELINE,1)
    INVOKE(BASELINE_SWITCH,1)

COMPLETE


ACTION BASELINE
    
    SET(COUNTER2,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGIN1")  
    
	INVOKE(LT1GREYLT2CHECK,1)
	
	LOGDATA(DATA_SNAPSHOT,"BEGIN")
	WAIT(UNIT_TIME)
    
	LOGDATA(DATA_SNAPSHOT,"AFTER1")
	LOGDATA(DATA_SELECT,"BEGIN1")            
	LOGDATA(DATA_DELTA,"AFTER1")
	
	LOGCREATE("RUNTIME|TEXT:BASELINE|COUNTER2") 
    LOGAPPEND("ZONE_DISTANCES:A1-2 Z1-4|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()                     

COMPLETE


ACTION BASELINE_SWITCH
	
    SET(COUNTER2,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGIN2")
    
    INVOKE(LT1CHECKLT2GREY,1)
 	
	WAIT(UNIT_TIME)
	LOGDATA(DATA_SNAPSHOT,"AFTER2")  
	LOGDATA(DATA_SELECT,"BEGIN2")     
	LOGDATA(DATA_DELTA,"AFTER2")
	
	LOGCREATE("RUNTIME|TEXT:BASELINE|COUNTER2") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()
	
COMPLETE                    


ACTION SHOCK_SEQ 
    	
    INVOKE(SHOCK,1)
    INVOKE(AFTER_SHOCK,1)

COMPLETE


ACTION SHOCK     

   	SET(COUNTER3,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"SHOCK")  
   
	INVOKE(LT1GREYLT2GREY,1)
	
	WAIT(1.5)            
	SET(VOLTAGE4,750) 
    	
    LOGDATA(DATA_SNAPSHOT,"AFTERSHOCK")  
	LOGDATA(DATA_SELECT,"SHOCK")     
	LOGDATA(DATA_DELTA,"AFTERSHOCK")
	
	LOGCREATE("RUNTIME|TEXT:SHOCK|COUNTER3") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()

COMPLETE


ACTION AFTER_SHOCK

	SET(COUNTER3,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"SHOCK") 
    
	INVOKE(LT1CHECKLT2CHECK,1)
	WAIT(8.5)		
    
    LOGDATA(DATA_SNAPSHOT,"AFTERSHOCK2")  
	LOGDATA(DATA_SELECT,"SHOCK")     
	LOGDATA(DATA_DELTA,"AFTERSHOCK2")
	
	LOGCREATE("RUNTIME|TEXT:AFTER_SHOCK|COUNTER3") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()
    
COMPLETE                


ACTION PROBE_SEQ 
    	
    INVOKE(PROBE,1)
    INVOKE(PROBE_SWITCH,1)

COMPLETE


ACTION PROBE                       

    SET(COUNTER4,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGINPROBE")	
    
	INVOKE(LT1GREYLT2CHECK,1)
   
	WAIT(PROBE_TIME)
	LOGDATA(DATA_SNAPSHOT,"AFTERPROBE")
	LOGDATA(DATA_SELECT,"BEGINPROBE")	
	LOGDATA(DATA_DELTA,"AFTERPROBE")
    
	LOGCREATE("RUNTIME|TEXT:PROBE|COUNTER4") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()           

COMPLETE


ACTION PROBE_SWITCH

	SET(COUNTER4,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGINPROBE2")
    
    INVOKE(LT1CHECKLT2GREY,1)
	 	
	WAIT(PROBE_TIME)
	LOGDATA(DATA_SNAPSHOT,"AFTER2PROBE") 
	LOGDATA(DATA_SELECT,"BEGINPROBE2")
	LOGDATA(DATA_DELTA,"AFTER2PROBE")

	LOGCREATE("RUNTIME|TEXT:PROBE|COUNTER4") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()
    
	LIGHTS(ALL,OFF)			

COMPLETE      



ACTION LT1GREYLT2CHECK

	SETLIGHT(LIGHT1,SPRITE,300,500,1000)
    SETLIGHT(LIGHT2,SPRITE,1300,500,1000)
    
	LOAD(SPRITE_FILE,"1:grey128x128")
	LOAD(SPRITE_FILE,"2:check640x640")
	LIGHTS(LIGHT1,ON)
	LIGHTS(LIGHT2,ON)

COMPLETE


ACTION LT1CHECKLT2GREY

	SETLIGHT(LIGHT1,SPRITE,300,500,1000)
    SETLIGHT(LIGHT2,SPRITE,1300,500,1000)
    
	LOAD(SPRITE_FILE,"1:check640x640")
	LOAD(SPRITE_FILE,"2:grey128x128")
	LIGHTS(LIGHT1,ON)
	LIGHTS(LIGHT2,ON)

COMPLETE


ACTION LT1GREYLT2GREY
	
    SETLIGHT(LIGHT1,SPRITE,300,500,1000)
    SETLIGHT(LIGHT2,SPRITE,1300,500,1000)
    
	LOAD(SPRITE_FILE,"1:grey128x128")
	LOAD(SPRITE_FILE,"2:grey128x128")
	LIGHTS(LIGHT1,ON)
	LIGHTS(LIGHT2,ON)

COMPLETE


ACTION LT1CHECKLT2CHECK
	
    SETLIGHT(LIGHT1,SPRITE,300,500,1000)
    SETLIGHT(LIGHT2,SPRITE,1300,500,1000)
    
	LOAD(SPRITE_FILE,"1:check640x640")
	LOAD(SPRITE_FILE,"2:check640x640")
	LIGHTS(LIGHT1,ON)
	LIGHTS(LIGHT2,ON)

COMPLETE
