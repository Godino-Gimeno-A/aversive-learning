# This sample script is written for a mild shock aversion learning assay.

# Users need to ensure that the correct assets are used in the script and saved to the unit's Media directory.

# The metal shocking plates should be plugged in and place at the ends of the tank. 


INCLUDE ZSYS			
      
DEFINE CIRCLE 1
DEFINE SQUARE 2
DEFINE SPRITE 5

# define experiment requirements

DEFINE UNIT_TIME 60							

# define the animal model tracking requirments (dependent on animal size)
SET(DETECTOR_THRESHOLD,5)
SET(SEARCH_DISTANCE,50)
SET(SEARCH_STEP,7)
SET(FILTER_RADIUS,15)

# define auto reference tracking requirements
SET(AUTOREF_MODE,0)		     #movement based        
SET(AUTOREF_TIMEOUT,60)
AUTOREFERENCE()

# loads tracking assets
LOAD(DETECTORS,"zones_2w.bmp")              
LOAD(ARENAS,"arenas_4l_shock.bmp") 

    
SET(COUNTER1,COUNTER_ZERO)


ACTION MAIN				   
    
	LIGHTS(ALL,OFF)                      
	AUTOREFERENCE()
    VIDEO(125,"24controlgrey")
	
    
    LOGCREATE("RUNTIME|TEXT:PHASE|TEXT:TIME_BIN")
    LOGAPPEND("TEXT:ARENA1_ZONE1_DISTANCE|TEXT:ARENA1_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA2_ZONE1_DISTANCE|TEXT:ARENA2_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA3_ZONE1_DISTANCE|TEXT:ARENA3_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA4_ZONE1_DISTANCE|TEXT:ARENA4_ZONE2_DISTANCE")
    LOGAPPEND("TEXT:ARENA1_ZONE1_TIME|TEXT:ARENA1_ZONE2_TIME")
    LOGAPPEND("TEXT:ARENA2_ZONE1_TIME|TEXT:ARENA2_ZONE2_TIME") 
    LOGAPPEND("TEXT:ARENA3_ZONE1_TIME|TEXT:ARENA3_ZONE2_TIME")
    LOGAPPEND("TEXT:ARENA4_ZONE1_TIME|TEXT:ARENA4_ZONE2_TIME") 
    LOGAPPEND("TEXT:ARENA1_ZONE1_ENTRIES|TEXT:ARENA1_ZONE2_ENTRIES")
    LOGAPPEND("TEXT:ARENA2_ZONE1_ENTRIES|TEXT:ARENA2_ZONE2_ENTRIES") 
    LOGAPPEND("TEXT:ARENA3_ZONE1_ENTRIES|TEXT:ARENA3_ZONE2_ENTRIES")
	LOGAPPEND("TEXT:ARENA4_ZONE1_ENTRIES|TEXT:ARENA4_ZONE2_ENTRIES")
    LOGAPPEND("TEXT:ARENA1_TOTAL_DISTANCE|TEXT:ARENA2_TOTAL_DISTANCE")
    LOGAPPEND("TEXT:ARENA3_TOTAL_DISTANCE|TEXT:ARENA4_TOTAL_DISTANCE")
    LOGRUN()
    
    LOGDATA(DATA_SNAPSHOT,"begin") 
	INVOKE(PROBE_SEQ,1) 
                    
	
    LOGDATA(DATA_SNAPSHOT,"after") 	
	LOGDATA(DATA_SELECT,"begin")         
	LOGDATA(DATA_DELTA,"after") 
    
    LOGCREATE("RUNTIME|TEXT:TOTAL|TEXT:") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()
    
COMPLETE			
    

ACTION PROBE_SEQ 
    
    INVOKE(PROBE,1)
    INVOKE(PROBE_SWITCH,1)

COMPLETE


ACTION PROBE
    
    SET(COUNTER1,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGIN1")  
    
	INVOKE(LT1GREYLT2CHECK,1)
	
	LOGDATA(DATA_SNAPSHOT,"BEGIN")
	WAIT(UNIT_TIME)
    
	LOGDATA(DATA_SNAPSHOT,"AFTER1")
	LOGDATA(DATA_SELECT,"BEGIN1")            
	LOGDATA(DATA_DELTA,"AFTER1")
	
	LOGCREATE("RUNTIME|TEXT:PROBE|COUNTER1") 
    LOGAPPEND("ZONE_DISTANCES:A1-2 Z1-4|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN() 
    

COMPLETE


ACTION PROBE_SWITCH
	
    SET(COUNTER1,COUNTER_INC)
    LOGDATA(DATA_SNAPSHOT,"BEGIN2")  
    
 	INVOKE(LT1CHECKLT2GREY,1)
 
	WAIT(UNIT_TIME)
	LOGDATA(DATA_SNAPSHOT,"AFTER2")  
	LOGDATA(DATA_SELECT,"BEGIN2")     
	LOGDATA(DATA_DELTA,"AFTER2")
	
	LOGCREATE("RUNTIME|TEXT:PROBE|COUNTER1") 
    LOGAPPEND("ZONE_DISTANCES:A1-4 Z1-2|ZONE_TIMERS:A1-4 Z1-2")
    LOGAPPEND("ZONE_COUNTERS:A1-4 Z1-2|ARENA_DISTANCES:A1-4")
	LOGRUN()
    
    LIGHTS(ALL,OFF)
	
COMPLETE            


ACTION LT1GREYLT2CHECK

	SETLIGHT(LIGHT1,SPRITE,300,500,1000)
    SETLIGHT(LIGHT2,SPRITE,1300,500,1000)
    
	LOAD(SPRITE_FILE,"1:grey128x128")
	LOAD(SPRITE_FILE,"2:check640x640")
	LIGHTS(LIGHT1,ON)
	LIGHTS(LIGHT2,ON)

COMPLETE


ACTION LT1CHECKLT2GREY

	SETLIGHT(LIGHT1,SPRITE,300,500,1000)
    SETLIGHT(LIGHT2,SPRITE,1300,500,1000)
    
	LOAD(SPRITE_FILE,"1:check640x640")
	LOAD(SPRITE_FILE,"2:grey128x128")
	LIGHTS(LIGHT1,ON)
	LIGHTS(LIGHT2,ON)

COMPLETE
